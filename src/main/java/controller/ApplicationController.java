/*
 *  Copyright Â© 2016 Litvinau Aleksei (ByAxe).
 *  Licensed under the Apache License, Version 2.0
 */

package controller;

import com.jfoenix.controls.*;
import com.jfoenix.validation.NumberValidator;
import core.dto.api.*;
import core.enums.CompensationType;
import core.enums.Stage;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.event.ActionEvent;
import javafx.event.Event;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.print.*;
import javafx.scene.control.*;
import javafx.scene.control.cell.PropertyValueFactory;
import javafx.scene.layout.AnchorPane;
import javafx.scene.layout.Pane;
import javafx.stage.FileChooser;
import jfxtras.scene.control.LocalDateTimeTextField;
import jfxtras.scene.control.agenda.icalendar.ICalendarAgenda;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;
import service.api.*;

import java.io.File;
import java.net.URL;
import java.time.LocalDateTime;
import java.util.List;
import java.util.Optional;
import java.util.ResourceBundle;
import java.util.stream.Stream;

import static core.commons.Utils.*;
import static java.util.stream.Collectors.toList;
import static javafx.scene.control.Alert.AlertType.ERROR;
import static javafx.scene.control.Alert.AlertType.INFORMATION;

/**
 * Created by byaxe on 03.12.16.
 */
@Component
public class ApplicationController implements Initializable {

    private static final Logger logger = LoggerFactory.getLogger(ApplicationController.class);

    public Label calendarStartDateLabel;
    public JFXTextField calendarEventTitlePicker;
    public JFXComboBox calendarNoticePeriodPicker;
    public Label calendarNoticePeriodLabel;
    public JFXComboBox calendarPriorityPicker;
    public Label calendarPriorityLabel;
    public JFXComboBox calendarFrequencyPicker;
    public Label calendarFrequencyLabel;
    public LocalDateTimeTextField calendarStartDatePicker;
    public Label calendarEndDateLabel;
    public LocalDateTimeTextField calendarEndDatePicker;
    public JFXButton calendarCreateEventButton;
    public JFXButton calendarClearEventButton;
    public JFXListView<Label> calendarUpcomingEventsListView;
    public Label calendarUpcomingEventsLabel;
    public SplitPane calendarLeftSplitPane;
    public AnchorPane calendarDatePickerPane;
    public AnchorPane calendarSchedulePane;
    public AnchorPane calendarRightPane;
    public JFXTabPane tabPane;
    public Tab calendarTab;
    public Tab scheduleTab;
    public SplitPane calendarRootSplitPane;
    public AnchorPane calendarLeftPane;
    public Tab allocationTab;
    public JFXButton calendarUpdateUpcomingEventsListButton;
    public MenuItem exitMenuItem;
    public MenuItem preferencesMenuItem;
    public MenuItem helpMenuItem;
    public MenuItem aboutMenuItem;
    public Pane calendarRightPaneBottomBlock;
    public SplitPane scheduleSplitPane;
    public AnchorPane scheduleLeftPane;
    public Label scheduleGroupsLabel;
    public JFXListView scheduleGroupsList;
    public AnchorPane scheduleRightPane;
    public ICalendarAgenda scheduleAgenda;
    public JFXCheckBox allocationArchiveFlag;
    public Tab notificationsTab;
    public TableView<IAllocationTableDTO> allocationTable;
    public Tab allocationTableTab;
    public Label allocationTableStageLabel;
    public JFXComboBox allocationTableStageComboBox;
    public JFXButton allocationTablePrintButton;
    public AnchorPane allocationTableBottomPane;
    public TableColumn allocationTableId;
    public TableColumn allocationTableStudent;
    public TableColumn allocationTableStudentFirstName;
    public TableColumn allocationTableStudentLastName;
    public TableColumn allocationTableStudentMiddleName;
    public TableColumn allocationTableStudentAddress;
    public TableColumn allocationTableStudentTelephone;
    public TableColumn allocationTableGroupNumber;
    public TableColumn allocationTableOrganisation;
    public TableColumn allocationTableOrganisationTitle;
    public TableColumn allocationTableOrganisationAddress;
    public TableColumn allocationTableOrganisationTelephone;
    public TableColumn allocationTableOrganisationContacts;
    public TableColumn allocationTableOrder;
    public TableColumn allocationTableOrderDate;
    public TableColumn allocationTableOrderNumber;
    public TableColumn allocationTableOrderProfession;
    public TableColumn allocationTableOrderRank;
    public TableColumn allocationTableConfirmations;
    public TableColumn allocationTableConfirmations_1;
    public TableColumn allocationTableConfirmations_2;
    public TableColumn allocationTableConfirmations_3;
    public TableColumn allocationTableConfirmations_4;
    public TableColumn allocationTableConfirmations_5;
    public TableColumn allocationTableConfirmations_6;
    public TableColumn allocationTableConfirmations_7;
    public TableColumn allocationTableConfirmations_8;
    public TableColumn allocationTableConfirmations_9;
    public TableColumn allocationTableConfirmations_10;
    public TableColumn allocationTableArmy;
    public TableColumn allocationTableFreeAllocation;
    public TableColumn allocationTableFreeAllocationFlag;
    public TableColumn allocationTableFreeAllocationReason;
    public TableColumn allocationTableReallocation;
    public TableColumn allocationTableReallocationFlag;
    public TableColumn allocationTableReallocationId;
    public TableColumn allocationTableVoluntaryCompensation;
    public TableColumn allocationTableVoluntaryCompensationOrderDate;
    public TableColumn allocationTableVoluntaryCompensationOrderNumber;
    public TableColumn allocationTableVoluntaryCompensationConfirmationDate;
    public TableColumn allocationTableCortCompensation;
    public TableColumn allocationTableCortCompensationOrderNumber;
    public TableColumn allocationTableCortCompensationOrderDate;
    public JFXButton allocationTableFilterApplyButton;
    public Label allocationTableTitle;
    public JFXTextField allocationTableIssueYear;
    public TableView<INotificationLogTableDTO> notificationsTable;
    public TableColumn notificationsTableId;
    public TableColumn notificationsTableDate;
    public TableColumn notificationsTableType;
    public TableColumn notificationsTableDescription;
    public JFXButton notificationsClearButton;
    public JFXButton allocationTableExcelButton;
    public Pane allocationHeaderPane;
    public Label allocationStudentLabel;
    public JFXButton allocationEditButton;
    public JFXTextField allocationSearchTextField;
    public JFXComboBox allocationStudentsList;
    public Label allocationGroupLabel;
    public JFXComboBox allocationGroupsList;
    public JFXCheckBox allocationArchive;
    public Label allocationOrganisationLabel;
    public JFXComboBox allocationOrganisationsList;
    public JFXCheckBox allocationArmy;
    public JFXCheckBox allocationFreeAllocation;
    public JFXTextArea allocationFreeAllocationReason;
    public Pane allocationConfirmationsPane;
    public Label allocationConfirmationsLabel;
    public JFXCheckBox allocationConfirmation_1;
    public JFXCheckBox allocationConfirmation_2;
    public JFXCheckBox allocationConfirmation_3;
    public JFXCheckBox allocationConfirmation_4;
    public JFXCheckBox allocationConfirmation_5;
    public JFXCheckBox allocationConfirmation_6;
    public JFXCheckBox allocationConfirmation_7;
    public JFXCheckBox allocationConfirmation_8;
    public JFXCheckBox allocationConfirmation_9;
    public JFXCheckBox allocationConfirmation_10;
    public JFXTextField allocationIssueYear;
    public Pane allocationOrderPane;
    public Label allocationOrderLabel;
    public JFXTextField allocationOrderNumber;
    public LocalDateTimeTextField allocationOrderDate;
    public JFXTextField allocationOrderProfession;
    public JFXTextField allocationOrderRank;
    public JFXTextArea allocationOrderPayload;
    public JFXCheckBox allocationReallocation;
    public Pane allocationCompensationPane;
    public Label allocationCompensationLabel;
    public JFXTextField allocationCompensationNumber;
    public LocalDateTimeTextField allocationCompensationDate;
    public JFXComboBox allocationCompensationType;
    public LocalDateTimeTextField allocationCompensationConfirmationDate;
    public JFXButton allocationSaveButton;
    public Tab managementTab;
    public Tab managementStudentsTab;
    public JFXTextField managementStudentLastName;
    public JFXTextField managementStudentFirstName;
    public JFXTextField managementStudentMiddleName;
    public JFXTextField managementStudentTelephone;
    public JFXTextField managementStudentAddress;
    public JFXButton managementStudentCleanButton;
    public JFXButton managementStudentSaveButton;
    public JFXListView<Label> managementStudentsList;
    public Tab managementGroupsTab;
    public JFXTextField managementGroupTitle;
    public JFXTextField managementGroupNumber;
    public JFXTextField managementGroupSpecialization;
    public JFXTextField managementGroupQualification;
    public JFXTextField managementGroupDescription;
    public JFXComboBox managementGroupRulers;
    public JFXListView<Label> managementGroupsList;
    public JFXButton managementGroupCleanButton;
    public JFXButton managementGroupSaveButton;
    public JFXListView<Label> managementRulersList;
    public JFXTextField managementRulerLastName;
    public JFXTextField managementRulerFirstName;
    public JFXTextField managementRulerMiddleName;
    public JFXTextField managementRulerPayload;
    public JFXButton managementRulerCleanButton;
    public JFXButton managementRulerSaveButton;
    public Tab managementRulersTab;
    public Tab managementOrganisationsTab;
    public JFXTextField managementOrganisationTitle;
    public JFXTextField managementOrganisationAddress;
    public JFXTextField managementOrganisationTelephone;
    public JFXTextField managementOrganisationContacts;
    public JFXListView<Label> managementOrganisationsList;
    public JFXButton managementOrganisationCleanButton;
    public JFXButton managementOrganisationSaveButton;
    public JFXTextField managementStudentId;
    public JFXTextField managementGroupId;
    public JFXTextField managementRulerId;
    public JFXTextField managementOrganisationId;
    public JFXTextField managementGroupHours;

    private ResourceBundle resourceBundle;
    private URL location;

    private IEventsService eventsService;
    private IGroupsService groupsService;
    private IAllocationService allocationService;
    private INotificationsLogService notificationsLogService;
    private IStudentsService studentsService;
    private IOrganisationsService organisationsService;
    private IRulersService rulersService;

    @Value("${calendar.upcoming.events.label.text}")
    private String upcomingEventsLabelText;

    @Value("${help.body}")
    private String HELP_BODY;

    @Value("${about.body}")
    private String ABOUT_BODY;

    public ApplicationController() {
    }

    @Autowired
    public ApplicationController(IEventsService eventsService, IGroupsService groupsService, IAllocationService allocationService,
                                 INotificationsLogService notificationsLogService, IStudentsService studentsService,
                                 IOrganisationsService organisationsService, IRulersService rulersService) {
        this.eventsService = eventsService;
        this.groupsService = groupsService;
        this.allocationService = allocationService;
        this.notificationsLogService = notificationsLogService;
        this.studentsService = studentsService;
        this.organisationsService = organisationsService;
        this.rulersService = rulersService;
    }

    @Override
    public void initialize(URL location, ResourceBundle resources) {
        this.resourceBundle = resources;
        this.location = location;

        initCalendarTab();
        initScheduleTab();
        initAllocationTab();
        initAllocationTableTab();
        initNotificationTab();
        initManagementTab();

        refresh();
    }

    /**
     * ÐÐµÑÐ³Ð°ÐµÑ Ð¸ Ð´ÐµÐ»Ð°ÐµÑ Ð²ÑÐµ, ÑÑÐ¾ Ð²ÐºÐ»Ð°Ð´ÐºÐ° ÐÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¸Ðº Ð±ÑÐ»Ð° ÑÑÐ¿ÐµÑÐ½Ð° Ð¸Ð½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°Ð½Ð½Ð° Ð¸ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð°
     */
    private void initCalendarTab() {
        calendarFillComboBoxes();
        calendarCleanEventForm(null);
        calendarFillUpcomingEventsList();
        calendarSetFormatForDatePickers();
        calendarCreateBigCalendar();
        calendarAddContextMenuToUpcomingEventsList();
    }

    /**
     * ÐÐ±ÑÐ°Ð±Ð¾ÑÐºÐ° Ð½Ð°Ð¶Ð°ÑÐ¸Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑÐ¾Ð±ÑÑÐ¸Ñ, Ð½Ð° Ð²ÐºÐ»Ð°Ð´ÐºÐµ ÐÐ°Ð»ÐµÐ½Ð´Ð°ÑÑ
     *
     * @param actionEvent
     */
    @FXML
    private void calendarCreateNewEvent(ActionEvent actionEvent) {
        eventsService.createNewEvent(
                calendarEventTitlePicker,
                calendarStartDatePicker,
                calendarEndDatePicker,
                calendarNoticePeriodPicker,
                calendarFrequencyPicker,
                calendarPriorityPicker,
                actionEvent
        );

        calendarHandleUpdateUpcomingEventsList();
    }

    /**
     * ÐÐ±ÑÐ°Ð±Ð¾ÑÐºÐ° Ð½Ð°Ð¶Ð°ÑÐ¸Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð¾ÑÐ¸ÑÑÐºÐ¸ ÑÐ¾ÑÐ¼Ñ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑÐ¾Ð±ÑÑÐ¸Ñ, Ð½Ð° Ð²ÐºÐ»Ð°Ð´ÐºÐµ ÐÐ°Ð»ÐµÐ½Ð´Ð°ÑÑ
     *
     * @param actionEvent
     */
    @FXML
    private void calendarCleanEventForm(ActionEvent actionEvent) {
        eventsService.cleanEventForm(
                calendarEventTitlePicker,
                calendarStartDatePicker,
                calendarEndDatePicker,
                calendarNoticePeriodPicker,
                calendarFrequencyPicker,
                calendarPriorityPicker,
                actionEvent);

        calendarHandleUpdateUpcomingEventsList();
    }

    @FXML
    private void handleExit(ActionEvent actionEvent) {
        System.exit(0);
    }

/*    @FXML
    private void handlePreferencesClick(ActionEvent actionEvent) {
        eventsService.showPreferences();
    }*/

    @FXML
    private void handleHelp(ActionEvent actionEvent) {
        raiseMessageBoxWithCustomSize(INFORMATION, "ÐÐ¾Ð¼Ð¾ÑÑ", null, HELP_BODY, 400, 600);
    }

    @FXML
    private void handleAbout(ActionEvent actionEvent) {
        raiseMessageBoxWithCustomSize(INFORMATION, "Ð Ð¿ÑÐ¾Ð³ÑÐ°Ð¼Ð¼Ðµ", null, ABOUT_BODY, 400, 600);
    }

    /**
     * ÐÑÐ²Ð¾Ð´Ð¸Ñ Ð² ÑÐ¿Ð¸ÑÐ¾Ðº Ð²ÑÐµ Ð¿Ð»Ð°Ð½Ð¸ÑÑÐµÐ¼ÑÐµ ÑÐ¾Ð±ÑÑÐ¸Ñ
     */
    @FXML
    private void calendarHandleUpdateUpcomingEventsList() {
        calendarUpcomingEventsLabel.setText(upcomingEventsLabelText);
        eventsService.fillUpcomingEventsList(calendarUpcomingEventsListView);
    }

    /**
     * ÐÐ°Ð¿Ð¾Ð»Ð½ÑÐµÑ ÐºÐ¾Ð¼Ð±Ð¾Ð±Ð¾ÐºÑÑ ÐºÐ°Ð»ÐµÐ½Ð´Ð°ÑÑ Ð¿ÐµÑÐµÑÐ¸ÑÐ»ÐµÐ½Ð¸ÑÐ¼Ð¸
     */
    private void calendarFillComboBoxes() {
        eventsService.fillComboBoxes(
                calendarNoticePeriodPicker,
                calendarFrequencyPicker,
                calendarPriorityPicker
        );
    }

    /**
     *
     */
    private void calendarAddContextMenuToUpcomingEventsList() {
        eventsService.addContextMenuToUpcomingEventsList(calendarUpcomingEventsListView);
    }

    /**
     * ÐÐ°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ ÑÐ¿Ð¸ÑÐºÐ° Ð¿ÑÐµÐ´ÑÑÐ¾ÑÑÐ¸Ñ ÑÐ¾Ð±ÑÑÐ¸Ð¹ Ð² ÐºÐ°Ð»ÐµÐ½Ð´Ð°ÑÐµ
     * ÐÑÑÐ¾ÑÑÐ¸ÑÐ¾Ð²Ð°Ð½ Ð¿Ð¾ Ð½Ð°ÑÐ°Ð»Ñ ÑÐ¾Ð±ÑÑÐ¸Ñ (ASC) (ÑÐ²ÐµÑÑÑ - Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑÐ¸Ðµ)
     */
    private void calendarFillUpcomingEventsList() {
        calendarUpcomingEventsLabel.setText(upcomingEventsLabelText);
        eventsService.fillUpcomingEventsList(calendarUpcomingEventsListView);
    }

    /**
     * Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð±Ð¾Ð»ÑÑÐ¾Ð¹ ÐºÐ°Ð»ÐµÐ½Ð´Ð°ÑÑ Ð´Ð»Ñ Ð²ÐºÐ»Ð°Ð´ÐºÐ¸ "ÐÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¸Ðº"
     */
    private void calendarCreateBigCalendar() {
        eventsService.createBigCalendar(calendarRightPaneBottomBlock, calendarUpcomingEventsLabel, calendarUpcomingEventsListView);
    }

    /**
     * Ð£ÑÑÐ°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ ÑÐ¿ÐµÑ ÑÐ¾ÑÐ¼Ð°Ñ Ð´Ð»Ñ Ð´Ð°ÑÐ° Ð² Ð¿Ð¾Ð»ÑÑ Ð²ÑÐ±Ð¾ÑÐ° Ð½Ð°ÑÐ°Ð»Ð° Ð¸ ÐºÐ¾Ð½ÑÐ° Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑÐ¾Ð±ÑÑÐ¸Ñ
     */
    private void calendarSetFormatForDatePickers() {
        calendarStartDatePicker.setDateTimeFormatter(CALENDAR_DATE_PICKER_FORMATTER);
        calendarEndDatePicker.setDateTimeFormatter(CALENDAR_DATE_PICKER_FORMATTER);
    }

    /**
     * ÐÐµÑÐ³Ð°ÐµÑ Ð¸ Ð´ÐµÐ»Ð°ÐµÑ Ð²ÑÐµ, ÑÑÐ¾ Ð²ÐºÐ»Ð°Ð´ÐºÐ° Ð Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð±ÑÐ»Ð° ÑÑÐ¿ÐµÑÐ½Ð° Ð¸Ð½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°Ð½Ð½Ð° Ð¸ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð°
     */
    private void initScheduleTab() {
    }

    /**
     * ÐÐµÑÐ³Ð°ÐµÑ Ð¸ Ð´ÐµÐ»Ð°ÐµÑ Ð²ÑÐµ, ÑÑÐ¾ Ð²ÐºÐ»Ð°Ð´ÐºÐ° Ð Ð°ÑÐ¿ÑÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ (Ð¢Ð°Ð±Ð»Ð¸ÑÐ°) Ð±ÑÐ»Ð° ÑÑÐ¿ÐµÑÐ½Ð° Ð¸Ð½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°Ð½Ð½Ð° Ð¸ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð°
     */
    private void initAllocationTableTab() {
        allocationTableFillComboBox();
        allocationTableSetDefaultValues();
        allocationTableAddFactoryForColumns();
        allocationTableLoadContentDefault();
    }

    /**
     * ÐÐ°ÐµÐ¼ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°Ð¼ Ð¿Ð¾Ð½ÑÑÑ, Ð¾ÑÐºÑÐ´Ð° Ð±ÑÐ°ÑÑ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
     */
    private void allocationTableAddFactoryForColumns() {

        // Ð£ÑÑÐ°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ ÐÐ´ÐµÐ½ÑÐ¸ÑÐ¸ÐºÐ°ÑÐ¾Ñ Ð·Ð°Ð¿Ð¸ÑÐ¸
        allocationTableId.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("id"));

        // ÐÐ°Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸ Ð¿Ð¾ ÐÑÐ¿ÑÑÐºÐ½Ð¸ÐºÑ
        {
            allocationTableStudentFirstName.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("studentFirstName"));
            allocationTableStudentMiddleName.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("studentMiddleName"));
            allocationTableStudentLastName.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("studentLastName"));
            allocationTableStudentAddress.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("studentAddress"));
            allocationTableStudentTelephone.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("studentTelephone"));
            allocationTableGroupNumber.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("groupNumber"));
        }

        // ÐÐ°Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸ Ð¿Ð¾ ÐÑÐ³Ð°Ð½Ð¸Ð·Ð°ÑÐ¸Ð¸
        {
            allocationTableOrganisationTitle.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("organisationTitle"));
            allocationTableOrganisationAddress.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("organisationAddress"));
            allocationTableOrganisationTelephone.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("organisationTelephone"));
            allocationTableOrganisationContacts.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("organisationContacts"));
        }

        // ÐÐ°Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸ Ð¿Ð¾ ÐÑÐ¸ÐºÐ°Ð·Ñ Ð¾ Ð¿ÑÐ¸ÐµÐ¼Ðµ Ð½Ð° ÑÐ°Ð±Ð¾ÑÑ
        {
            allocationTableOrderDate.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("orderDate"));
            allocationTableOrderNumber.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("orderNumber"));
            allocationTableOrderProfession.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("orderProfession"));
            allocationTableOrderRank.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("orderRank"));
        }

        // ÐÐ°Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ Ð¿Ð¾Ð´ÑÐ²ÐµÑÐ¶Ð´ÐµÐ½Ð¸Ñ. ÐÑÐ³ÑÐ´Ð¸Ñ ÐºÐ°Ðº ÑÐ¶Ð°ÑÐ½ÑÐ¹ ÐºÐ¾ÑÑÑÐ»Ñ...
        {
            allocationTableConfirmations_1.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("confirmations_1"));
            allocationTableConfirmations_2.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("confirmations_2"));
            allocationTableConfirmations_3.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("confirmations_3"));
            allocationTableConfirmations_4.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("confirmations_4"));
            allocationTableConfirmations_5.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("confirmations_5"));
        }

        // ÐÑÑÐ³Ð¸Ðµ Ð½Ð°ÑÑÑÐ¾Ð¹ÐºÐ¸
        {
            allocationTableArmy.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("army"));
            allocationTableFreeAllocationFlag.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("freeAllocationFlag"));
            allocationTableFreeAllocationReason.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("freeAllocationReason"));
            allocationTableReallocationFlag.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("reallocationFlag"));
            allocationTableReallocationId.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("army"));
        }

        // ÐÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°ÑÐ¸Ð¸ Ð¸ Ñ.Ð´.
        {
            allocationTableVoluntaryCompensationOrderDate.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("voluntaryCompensationOrderDate"));
            allocationTableVoluntaryCompensationOrderNumber.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("voluntaryCompensationOrderNumber"));
            allocationTableVoluntaryCompensationConfirmationDate.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("voluntaryCompensationConfirmationDate"));
            allocationTableCortCompensationOrderNumber.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("cortCompensationOrderNumber"));
            allocationTableCortCompensationOrderDate.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("cortCompensationOrderDate"));

        }
    }

    /**
     * ÐÐ°Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ ÐºÐ¾Ð¼Ð±Ð¾Ð±Ð¾ÐºÑÑ Ð½Ð° Ð²ÐºÐ»Ð°Ð´ÐºÐµ Ð Ð°ÑÐ¿ÑÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ (ÑÐ°Ð±Ð»Ð¸ÑÐ°)
     */
    private void allocationTableFillComboBox() {
        allocationService.fillComboBox(allocationTableStageComboBox);
    }

    /**
     * Ð£ÑÑÐ°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ñ Ð¿Ð¾ ÑÐ¼Ð¾Ð»ÑÐ°Ð½Ð¸Ñ Ð½Ð° Ð²ÐºÐ»Ð°Ð´ÐºÐµ Ð Ð°ÑÐ¿ÑÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ (ÑÐ°Ð±Ð»Ð¸ÑÐ°)
     */
    private void allocationTableSetDefaultValues() {
        allocationService.setDefaultValues(allocationTableStageComboBox);
        allocationTableIssueYear.setValidators(new NumberValidator());

    }

    /**
     * ÐÐ°Ð³ÑÑÐ¶Ð°ÐµÑ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð² ÑÐ°Ð±Ð»Ð¸ÑÑ Ð Ð°ÑÐ¿ÑÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ
     */
    private void allocationTableLoadContent(Stage stage, Boolean archive, Integer issueYear) {
        allocationTableModifyColumns(stage, issueYear);

        ObservableList<IAllocationTableDTO> content = FXCollections.observableArrayList();
        content.addAll(allocationService.find(stage, archive, issueYear));

        allocationTable.setItems(content);

        logger.info("ÐÐ°Ð³ÑÑÐ¶ÐµÐ½ ÐºÐ¾Ð½ÑÐµÐ½Ñ Ð² ÑÐ°Ð±Ð»Ð¸ÑÑ ÑÐ°ÑÐ¿ÑÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ.");
    }

    /**
     * ÐÐ°Ð³ÑÑÐ¶Ð°ÐµÑ Ð´Ð°Ð½Ð½ÑÐµ Ð¿Ð¾ ÑÐ¼Ð¾Ð»ÑÐ°Ð½Ð¸Ñ Ð² ÑÐ°Ð±Ð»Ð¸ÑÑ Ð Ð°ÑÐ¿ÑÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ
     */
    private void allocationTableLoadContentDefault() {
        allocationTableLoadContent(Stage.FIRST, false, LocalDateTime.now().getYear());
    }

    /**
     * ÐÐ¾Ð´Ð¸ÑÐ¸ÑÐ¸ÑÑÐµÑ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸ ÑÐ°Ð±Ð»Ð¸ÑÑ Ð Ð°ÑÐ¿ÑÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ
     *
     * @param stage     ÑÑÑÐ¿ÐµÐ½Ñ
     * @param issueYear Ð³Ð¾Ð´ Ð²ÑÐ¿ÑÑÐºÐ°
     */
    private void allocationTableModifyColumns(final Stage stage, final int issueYear) {
        TableColumnBase confirmationsParent = allocationTableConfirmations_1.getParentColumn();

        if (stage == Stage.SECOND) {

            final int nextYear = issueYear + 1;
            final int nextNextYear = nextYear + 1;

            addYearToColumnTitle(allocationTableConfirmations_1, issueYear);
            addYearToColumnTitle(allocationTableConfirmations_2, issueYear);
            addYearToColumnTitle(allocationTableConfirmations_3, nextYear);
            addYearToColumnTitle(allocationTableConfirmations_4, nextYear);
            addYearToColumnTitle(allocationTableConfirmations_5, nextYear);

            allocationTableConfirmations_6 = createTableColumn(CONFIRMATION_PERIOD_1);
            addYearToColumnTitle(allocationTableConfirmations_6, nextYear);

            allocationTableConfirmations_7 = createTableColumn(CONFIRMATION_PERIOD_2);
            addYearToColumnTitle(allocationTableConfirmations_7, nextYear);

            allocationTableConfirmations_8 = createTableColumn(CONFIRMATION_PERIOD_3);
            addYearToColumnTitle(allocationTableConfirmations_8, nextNextYear);

            allocationTableConfirmations_9 = createTableColumn(CONFIRMATION_PERIOD_4);
            addYearToColumnTitle(allocationTableConfirmations_9, nextNextYear);

            allocationTableConfirmations_10 = createTableColumn(CONFIRMATION_PERIOD_5);
            addYearToColumnTitle(allocationTableConfirmations_10, nextNextYear);

            allocationTableConfirmations_6.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("confirmations_6"));
            allocationTableConfirmations_7.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("confirmations_7"));
            allocationTableConfirmations_8.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("confirmations_8"));
            allocationTableConfirmations_9.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("confirmations_9"));
            allocationTableConfirmations_10.setCellValueFactory(new PropertyValueFactory<IAllocationTableDTO, String>("confirmations_10"));

            confirmationsParent.getColumns()
                    .setAll(allocationTableConfirmations_1, allocationTableConfirmations_2,
                            allocationTableConfirmations_3, allocationTableConfirmations_4,
                            allocationTableConfirmations_5, allocationTableConfirmations_6,
                            allocationTableConfirmations_7, allocationTableConfirmations_8,
                            allocationTableConfirmations_9, allocationTableConfirmations_10);
        } else {
            confirmationsParent.getColumns()
                    .setAll(allocationTableConfirmations_1, allocationTableConfirmations_2,
                            allocationTableConfirmations_3, allocationTableConfirmations_4,
                            allocationTableConfirmations_5);
        }
    }

    /**
     * ÐÑÐ¸Ð¼ÐµÐ½ÑÐµÑ Ð²ÑÐ±ÑÐ°Ð½Ð½ÑÐµ ÑÐ¸Ð»ÑÑÑÑ Ðº Ð²ÑÐ±Ð¾ÑÐºÐµ Ð´Ð°Ð½Ð½ÑÑ
     *
     * @param actionEvent
     */
    @FXML
    private void allocationTableFilterApply(ActionEvent actionEvent) {
        try {
            boolean archive = allocationArchiveFlag.isSelected();

            int issueYear = allocationTableIssueYear.validate()
                    ? Integer.valueOf(allocationTableIssueYear.getText())
                    : LocalDateTime.now().getYear();

            Stream.of(Stage.values()).forEach(s -> {
                if (s.getTitle().equals(String.valueOf(allocationTableStageComboBox.getValue()))) {
                    allocationTableLoadContent(s, archive, issueYear);
                }
            });

        } catch (Exception e) {
            allocationTableLoadContentDefault();
            logger.error("ÐÑÐ¸Ð±ÐºÐ° Ð¿ÑÐ¸ Ð¿Ð¾Ð¿ÑÑÐºÐµ ÑÐ¸Ð»ÑÑÑÐ°ÑÐ¸Ð¸ Ð´Ð°Ð½Ð½ÑÑ. ÐÐ°Ð³ÑÑÐ¶ÐµÐ½Ñ ÑÐ¸Ð»ÑÑÑÑ Ð¿Ð¾ ÑÐ¼Ð¾Ð»ÑÐ°Ð½Ð¸Ñ", e);
        }

    }

    /**
     * ÐÐµÑÐ°ÑÐ°ÐµÑ ÑÐ¾Ð´ÐµÑÐ¶Ð¸Ð¼Ð¾Ðµ Ð¢Ð°Ð±Ð»Ð¸ÑÑ Ð Ð°ÑÐ¿ÑÐµÐ´Ð»ÐµÐ½Ð¸Ñ
     *
     * @param actionEvent
     */
    @FXML
    private void allocationPrintButtonClick(ActionEvent actionEvent) {

        PrinterJob printerJob = PrinterJob.createPrinterJob();
        raiseMessageBox(ERROR, "ÐÑÐ¸Ð±ÐºÐ°", "ÐÑÐ¸Ð±ÐºÐ° Ð¿ÑÐ¸ Ð¿Ð¾Ð¿ÑÑÐºÐµ Ð¿ÐµÑÐ°ÑÐ¸.", "Ð ÑÐ¸ÑÑÐµÐ¼Ðµ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð¿ÑÐ¸Ð½ÑÐµÑ!\nÐ§ÑÐ¾Ð±Ñ Ð½Ð°Ð¿ÐµÑÐ°ÑÐ°ÑÑ ÑÑÐ¾ Ð»Ð¸Ð±Ð¾, Ð²Ñ Ð´Ð¾Ð»Ð¶Ð½Ñ ÑÐ½Ð°ÑÐ°Ð»Ð° Ð¿Ð¾Ð´ÐºÐ»ÑÑÐ¸ÑÑ Ð¿ÑÐ¸Ð½ÑÐµÑ.");
        if (printerJob == null) return; // Ð½ÐµÑ Ð¿ÑÐ¸Ð½ÑÐµÑÐ°

        if (!printerJob.showPrintDialog(null)) return;

        Printer printer = Printer.getDefaultPrinter();
        PageLayout pageLayout = printer.createPageLayout(Paper.A2, PageOrientation.LANDSCAPE, Printer.MarginType.DEFAULT);
        printerJob.getJobSettings().setPageLayout(pageLayout);

        printerJob.printPage(allocationTable);
    }

    /**
     * Ð¡Ð¾ÑÑÐ°Ð½ÑÐµÑ ÑÐ¾Ð´ÐµÑÐ¶Ð¸Ð¼Ð¾Ðµ Ð¢Ð°Ð±Ð»Ð¸ÑÑ Ð Ð°ÑÐ¿ÑÐµÐ´Ð»ÐµÐ½Ð¸Ñ Ð² excel ÑÐ°Ð¹Ð»
     *
     * @param actionEvent
     */
    @FXML
    private void allocationExcelButtonClick(ActionEvent actionEvent) {
        FileChooser fileChooser = new FileChooser();

        String allocationYear = allocationTableIssueYear.validate() ? allocationTableIssueYear.getText() : String.valueOf(2016);
        fileChooser.setInitialFileName("Ð£ÑÐµÑ ÑÐ°ÑÐ¿ÑÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ (Ð²ÑÐ¿ÑÑÐº " + allocationYear + " Ð³Ð¾Ð´Ð°).xls");

        fileChooser.setTitle("Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ ÑÐ°Ð±Ð»Ð¸ÑÑ");
        File file = fileChooser.showSaveDialog(null);

        if (file != null) {
            try {
                allocationService.exportTableToExcel(file, allocationTable);
            } catch (Exception ex) {
                System.out.println(ex.getMessage());
            }
        }
    }


    /**
     * ÐÐµÑÐ³Ð°ÐµÑ Ð¸ Ð´ÐµÐ»Ð°ÐµÑ Ð²ÑÐµ, ÑÑÐ¾ Ð²ÐºÐ»Ð°Ð´ÐºÐ° Ð Ð°ÑÐ¿ÑÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð±ÑÐ»Ð° ÑÑÐ¿ÐµÑÐ½Ð° Ð¸Ð½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°Ð½Ð½Ð° Ð¸ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð°
     */
    private void initAllocationTab() {
        allocationSearchTextField.setValidators(new NumberValidator());
        allocationFillComboBox();

    }


    /**
     * ÐÐ°Ð¿Ð¾Ð»Ð½Ð¸ÑÑ ÐºÐ¾Ð¼Ð±Ð¾Ð±Ð¾ÐºÑÑ Ð½Ð° Ð²ÐºÐ»Ð°Ð´ÐºÐµ Ð Ð°ÑÐ¿ÑÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ
     */
    private void allocationFillComboBox() {
        List<IStudentsDTO> students = (List<IStudentsDTO>) studentsService.findAll();
        List<IOrganisationsDTO> organisations = (List<IOrganisationsDTO>) organisationsService.findAll();
        List<IGroupsDTO> groups = (List<IGroupsDTO>) groupsService.findAll();

        students.forEach(e -> allocationStudentsList.getItems().add(e.getId()));
        organisations.forEach(e -> allocationOrganisationsList.getItems().add(e.getId()));
        groups.forEach(e -> allocationGroupsList.getItems().add(e.getId()));

        allocationCompensationType.getItems()
                .setAll(Stream.of(CompensationType.values()).map(CompensationType::getType).collect(toList()));
    }

    /**
     * ÐÐµÑÐ³Ð°ÐµÑ Ð¸ Ð´ÐµÐ»Ð°ÐµÑ Ð²ÑÐµ, ÑÑÐ¾ Ð²ÐºÐ»Ð°Ð´ÐºÐ° Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹ Ð±ÑÐ»Ð° ÑÑÐ¿ÐµÑÐ½Ð° Ð¸Ð½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð¸ÑÐ¾Ð²Ð°Ð½Ð½Ð° Ð¸ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð°
     */
    private void initNotificationTab() {
        notificationsTableAddFactoryForColumns();
        notificationsTableUpdate();
    }

    /**
     * ÐÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÑÐ°Ð±Ð»Ð¸ÑÑ Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹
     */
    private void notificationsTableUpdate() {
        ObservableList<INotificationLogTableDTO> content = FXCollections.observableArrayList();
        content.addAll(notificationsLogService.findAllForTable());

        notificationsTable.setItems(content);

        logger.info("ÐÐ°Ð³ÑÑÐ¶ÐµÐ½ ÐºÐ¾Ð½ÑÐµÐ½Ñ Ð² ÑÐ°Ð±Ð»Ð¸ÑÑ ÑÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹.");
    }

    /**
     * ÐÐ°ÐµÐ¼ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°Ð¼ Ð¿Ð¾Ð½ÑÑÑ, Ð¾ÑÐºÑÐ´Ð° Ð±ÑÐ°ÑÑ Ð·Ð½Ð°ÑÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
     */
    private void notificationsTableAddFactoryForColumns() {
        notificationsTableId.setCellValueFactory(new PropertyValueFactory<INotificationLogTableDTO, String>("id"));
        notificationsTableDate.setCellValueFactory(new PropertyValueFactory<INotificationLogTableDTO, String>("date"));
        notificationsTableType.setCellValueFactory(new PropertyValueFactory<INotificationLogTableDTO, String>("type"));
        notificationsTableDescription.setCellValueFactory(new PropertyValueFactory<INotificationLogTableDTO, String>("description"));
    }

    /**
     * ÐÐ±ÑÐ°Ð±Ð°ÑÑÐ²Ð°ÐµÐ¼ Ð½Ð°Ð¶Ð°ÑÐ¸Ðµ Ð½Ð° Ð¾ÑÐ¸ÑÑÐºÑ ÑÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹
     *
     * @param actionEvent
     */
    @FXML
    public void handleNotificationsClear(ActionEvent actionEvent) {
        notificationsLogService.deleteAll();
        notificationsTab.setText("Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ");
        notificationsTable.setItems(FXCollections.observableArrayList());
    }

    /**
     * ÐÐ°Ð¶Ð°ÑÐ¸Ðµ Ð½Ð° Ð²ÐºÐ»Ð°Ð´ÐºÑ "Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹"
     *
     * @param event
     */
    @FXML
    private void notificationsTabChoose(Event event) {
        notificationsTableUpdate();
    }

    @FXML
    private void allocationEditButtonClick(ActionEvent actionEvent) {

        if (allocationSearchTextField.validate()) {
            final long id = Long.parseLong(allocationSearchTextField.getText());

            IAllocationDTO allocation = allocationService.findOne(id);

            if (allocation == null) {
                raiseMessageBox(INFORMATION, "ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾", "ÐÐ¾Ð¸ÑÐº Ð½Ðµ Ð´Ð°Ð» ÑÐµÐ·ÑÐ»ÑÑÐ°ÑÐ¾Ð²", "ÐÐ°Ð¿Ð¸ÑÑ Ð¾ ÑÐ°ÑÐ¿ÑÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ð¸ Ñ Ð´Ð°Ð½Ð½ÑÐ¼ Ð½Ð¾Ð¼ÐµÑÐ¾Ð¼ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°.");
                return;
            }

            allocationCompensationType.getItems()
                    .setAll(Stream.of(CompensationType.values()).map(CompensationType::getType).collect(toList()));

            IGroupsDTO group = allocation.getGroup();
            IStudentsDTO student = allocation.getStudent();
            IOrganisationsDTO organisation = allocation.getOrganisation();

            allocationStudentsList.getItems().setAll(student.toPrettyString());
            allocationOrganisationsList.getItems().setAll(organisation.toPrettyString());
            allocationGroupsList.getItems().setAll(group.toPrettyString());

            // TODO ÑÐ°Ð·Ð»Ð¾Ð¶Ð¸ÑÑ Ð´Ð°Ð½Ð½ÑÐµ Ð¿Ð¾ Ð¿Ð¾Ð»ÑÐ¼
        }

    }


    @FXML
    private void allocationSaveButtonClick(ActionEvent actionEvent) {
    }


    /**
     * ÐÐ½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð¸ÑÑÐµÐ¼ Ð²ÑÐµ Ð²ÐºÐ»Ð°Ð´ÐºÐ¸ Ð£Ð¿ÑÐ°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¡ÑÑÐ½Ð¾ÑÑÑÐ¼Ð¸
     */
    private void initManagementTab() {
        initManagementStudentsTab();
        initManagementGroupsTab();
        initManagementRulersTab();
        initManagementOrganisationsTab();
    }

    /**
     * ÐÐ½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð¸ÑÑÐµÐ¼ Ð²ÐºÐ»Ð°Ð´ÐºÑ ÑÐ¿ÑÐ°Ð²Ð»ÐµÐ½Ð¸Ñ Ð²ÑÐ¿ÑÑÐºÐ½Ð¸ÐºÐ°Ð¼Ð¸
     */
    private void initManagementStudentsTab() {
        studentsService.fillStudentsList(managementStudentsList);

        studentsService.addContextMenuToStudentsList(managementStudentsList, managementStudentId,
                managementStudentFirstName, managementStudentMiddleName, managementStudentLastName,
                managementStudentTelephone, managementStudentAddress);

        managementStudentCleanForm();
    }

    /**
     * ÐÐ½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð¸ÑÑÐµÐ¼ Ð²ÐºÐ»Ð°Ð´ÐºÑ ÑÐ¿ÑÐ°Ð²Ð»ÐµÐ½Ð¸Ñ Ð³ÑÑÐ¿Ð¿Ð°Ð¼Ð¸
     */
    private void initManagementGroupsTab() {
        groupsService.fillGroupsList(managementGroupsList);

        managementGroupHours.setValidators(new NumberValidator());

        groupsService.addContextMenuToGroupsList(managementGroupsList, managementGroupId, managementGroupTitle,
                managementGroupQualification, managementGroupNumber, managementGroupSpecialization,
                managementGroupDescription, managementGroupHours, managementGroupRulers);

        managementGroupCleanForm();

    }

    /**
     * ÐÐ½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð¸ÑÑÐµÐ¼ Ð²ÐºÐ»Ð°Ð´ÐºÑ ÑÐ¿ÑÐ°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÑÐºÐ¾Ð²Ð¾Ð´Ð¸ÑÐµÐ»ÑÐ¼Ð¸
     */
    private void initManagementRulersTab() {
        rulersService.fillRulersList(managementRulersList);

        rulersService.addContextMenuToRulersList(managementRulersList, managementRulerId, managementRulerFirstName,
                managementRulerMiddleName, managementRulerLastName, managementRulerPayload);

        managementRulersCleanForm();
    }

    /**
     * ÐÐ½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð¸ÑÑÐµÐ¼ Ð²ÐºÐ»Ð°Ð´ÐºÑ ÑÐ¿ÑÐ°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¾ÑÐ³Ð°Ð½Ð¸Ð·Ð°ÑÐ¸ÑÐ¼Ð¸
     */
    private void initManagementOrganisationsTab() {
        organisationsService.fillOrganisationList(managementOrganisationsList);

        organisationsService.addContextMenuToOrganisationsList(managementOrganisationsList, managementOrganisationId, managementOrganisationTitle,
                managementOrganisationAddress, managementOrganisationTelephone, managementOrganisationContacts);

        managementOrganisationsCleanForm();
    }

    private void managementGroupCleanForm() {
        managementGroupId.setText("0");
        managementGroupTitle.setText("");
        managementGroupQualification.setText("");
        managementGroupNumber.setText("");
        managementGroupSpecialization.setText("");
        managementGroupDescription.setText("");
        managementGroupHours.setText("");
    }


    /**
     * Ð¡Ð¾ÑÑÐ°Ð½ÑÐµÐ¼ ÑÐµÐºÑÑÑÑ ÑÑÑÐ½Ð¾ÑÑÑ
     *
     * @param actionEvent
     */
    @FXML
    private void managementStudentSaveButtonClick(ActionEvent actionEvent) {

        long id = Long.parseLong(managementStudentId.getText());
        String firstName = managementStudentFirstName.getText();
        String middleName = managementStudentMiddleName.getText();
        String lastName = managementStudentLastName.getText();
        String telephone = managementStudentTelephone.getText();
        String address = managementStudentAddress.getText();

        studentsService.save(id, firstName, middleName, lastName, telephone, address);

        managementStudentCleanForm();
        studentsService.fillStudentsList(managementStudentsList);

        refresh();
    }

    /**
     * ÐÐ±ÑÐ°Ð±Ð°ÑÑÐ²Ð°ÐµÐ¼ Ð½Ð°Ð¶Ð°ÑÐ¸Ðµ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑ Ð¾ÑÐ¸ÑÑÐºÐ¸ ÑÐ¾ÑÐ¼Ñ ÑÐ¾ÑÑÐ°Ð½ÐµÐ½Ð¸Ñ ÑÑÑÐ´ÐµÐ½ÑÐ°
     *
     * @param actionEvent
     */
    @FXML
    private void managementStudentCleanButtonClick(ActionEvent actionEvent) {
        managementStudentCleanForm();
    }

    /**
     * ÐÑÑÐ¸ÑÐ°ÐµÑ Ð´Ð°Ð½Ð½ÑÐµ Ð¸Ð· Ð¿Ð¾Ð»ÐµÐ¹ ÑÐ¾ÑÑÐ°Ð½ÐµÐ½Ð¸Ñ ÑÑÑÐ½Ð¾ÑÑÐ¸ Ð²ÑÐ¿ÑÑÐºÐ½Ð¸ÐºÐ°
     */
    private void managementStudentCleanForm() {
        managementStudentId.setText("0");
        managementStudentFirstName.setText("");
        managementStudentMiddleName.setText("");
        managementStudentLastName.setText("");
        managementStudentTelephone.setText("");
        managementStudentAddress.setText("");
    }

    /**
     * ÐÐ°Ð¶Ð°ÑÐ¸Ðµ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑ Ð¾ÑÐ¸ÑÑÐ¸ÑÑ ÑÐ¾ÑÐ¼Ñ ÑÐ¾ÑÑÐ°Ð½ÐµÐ½Ð¸Ñ Ð³ÑÑÐ¿Ð¿Ñ
     *
     * @param actionEvent
     */
    @FXML
    private void managementGroupCleanButtonClick(ActionEvent actionEvent) {
        managementGroupCleanForm();
    }

    /**
     * ÐÐ°Ð¶Ð°ÑÐ¸Ðµ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑ ÑÐ¾ÑÑÐ°Ð½Ð¸ÑÑ Ð³ÑÑÐ¿Ð¿Ñ
     *
     * @param actionEvent
     */
    @FXML
    private void managementGroupSaveButtonClick(ActionEvent actionEvent) {

        Long id = Long.valueOf(managementGroupId.getText());
        String title = managementGroupTitle.getText();
        String qualification = managementGroupQualification.getText();
        String number = managementGroupNumber.getText();
        String specialisation = managementGroupSpecialization.getText();
        String description = managementGroupDescription.getText();
        String hours = managementGroupHours.getText();
        String ruler = String.valueOf(managementGroupRulers.getSelectionModel().getSelectedItem());

        groupsService.save(id, title, qualification, number, specialisation, description, hours, ruler);

        managementGroupCleanForm();

        groupsService.fillGroupsList(managementGroupsList);

        refresh();
    }

    /**
     * ÐÐ°Ð¶Ð°ÑÐ¸Ðµ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑ Ð¾ÑÐ¸ÑÑÐ¸ÑÑ ÑÐ¾ÑÐ¼Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ¿ÑÐ°Ð²Ð»ÑÑÑÐµÐ³Ð¾
     *
     * @param actionEvent
     */
    @FXML
    private void managementRulerCleanButtonClick(ActionEvent actionEvent) {
        managementRulersCleanForm();
    }

    /**
     * ÐÑÑÐ¸ÑÐ°ÐµÑ Ð´Ð°Ð½Ð½ÑÐµ Ð¸Ð· Ð¿Ð¾Ð»ÐµÐ¹ ÑÐ¾ÑÑÐ°Ð½ÐµÐ½Ð¸Ñ ÑÑÑÐ½Ð¾ÑÑÐ¸ ÑÐ¿ÑÐ°Ð²Ð»ÑÑÑÐµÐ³Ð¾
     */
    private void managementRulersCleanForm() {
        managementRulerId.setText("0");
        managementRulerFirstName.setText("");
        managementRulerMiddleName.setText("");
        managementRulerLastName.setText("");
        managementRulerPayload.setText("");
    }

    @FXML
    private void managementRulerSaveButtonClick(ActionEvent actionEvent) {
        Long id = Long.valueOf(managementRulerId.getText());
        String firstName = managementRulerFirstName.getText();
        String middleName = managementRulerMiddleName.getText();
        String lastName = managementRulerLastName.getText();
        String payload = managementRulerPayload.getText();

        rulersService.save(id, firstName, middleName, lastName, payload);

        managementRulersCleanForm();

        rulersService.fillRulersList(managementRulersList);

        refresh();
    }

    @FXML
    private void managementOrganisationCleanButtonClick(ActionEvent actionEvent) {
        managementOrganisationsCleanForm();
    }

    private void managementOrganisationsCleanForm() {
        managementOrganisationId.setText("0");
        managementOrganisationTitle.setText("");
        managementOrganisationAddress.setText("");
        managementOrganisationTelephone.setText("");
        managementOrganisationContacts.setText("");
    }


    @FXML
    private void managementOrganisationSaveButtonClick(ActionEvent actionEvent) {
        Long id = Long.valueOf(managementOrganisationId.getText());
        String title = managementOrganisationTitle.getText();
        String address = managementOrganisationAddress.getText();
        String telephone = managementOrganisationTelephone.getText();
        String contacts = managementOrganisationContacts.getText();

        organisationsService.save(id, title, address, telephone, contacts);

        managementOrganisationsCleanForm();

        organisationsService.fillOrganisationList(managementOrganisationsList);

        refresh();
    }

    /**
     * ÐÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð´Ð°Ð½Ð½ÑÐµ Ð²Ð¾ Ð²ÑÐµÑ ÐºÐ¾Ð¼Ð±Ð¾Ð±Ð¾ÐºÑÐ°Ñ Ð³Ð´Ðµ ÑÑÐ°ÑÑÐ²ÑÑÑ Ð¸Ð·Ð¼ÐµÐ½ÑÐµÐ¼ÑÐµ ÑÑÑÐ½Ð¾ÑÑÐ¸
     */
    public void refresh() {
        managementGroupRulers.getItems().clear();
        Optional.ofNullable(((List<IRulersDTO>) rulersService.findAll()))
                .ifPresent(l -> l.forEach(r -> {
                    managementGroupRulers.getItems().add(r.toPrettyString());
                }));


    }
}
